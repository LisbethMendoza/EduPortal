{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Agregar Aviso</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="{% static 'imagenes/logo.ico.jpg' %}" type="image/x-icon">
  <style>
     * {
      box-sizing: border-box;
    }

    body {
      background-image: url("{% static 'imagenes/Fondo.jpg' %}");
      background-color: #e8f5e9;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      padding: 20px;
    }

    .form-container {
      background-color: white;
      padding: 25px 30px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0, 124, 128, 0.2);
      width: 100%;
      max-width: 500px; /* ancho máximo en pantallas grandes */
    }

    .form-container h2 {
      color: #18798a;
      margin-bottom: 20px;
      text-align: center;
      font-size: 1.8rem;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
      color: #18798a;
    }

    input[type="text"],
    textarea,
    input[type="date"],
    select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 8px;
      border: 2px solid #a5c6d6;
      font-size: 14px;
    }

    .button-group {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap; /* para móviles se acomoden verticalmente */
    }

    .button-group input[type="submit"],
    .button-group button {
      flex: 1 1 45%; /* ocupan 45% del ancho, se ajusta en móviles */
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      color: white;
      text-align: center;
    }

    .btn-publicar {
      background-color: #419dad;
    }

    .btn-publicar:hover {
      background-color: #18798a;
    }

    .btn-eliminar {
      background-color: #ef5350;
    }

    .btn-eliminar:hover {
      background-color: #c62828;
    }

    /* Ajustes para pantallas pequeñas */
    @media (max-width: 500px) {
      .form-container {
        padding: 20px;
      }

      .form-container h2 {
        font-size: 1.5rem;
      }

      .button-group input[type="submit"],
      .button-group button {
        flex: 1 1 100%; 
      }
    }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>Bienvenido, {{ nombre }}</h2>
    <h2>Agregar Aviso</h2>
    <form action="." method="post">
      {% csrf_token %}
      <input type="hidden" id="id_aviso" name="id_aviso">

      <label for="titulo">Título:</label>
      <input type="text" id="titulo" name="titulo" required>

      <label for="descripcion">Descripción:</label>
      <textarea id="descripcion" name="descripcion" rows="4" required></textarea>

      <label for="fecha_publi">Fecha de Publicación:</label>
      <input type="date" id="fecha_publi" name="fecha_publi" required>

      <label for="fecha_fin">Fecha de Finalización:</label>
      <input type="date" id="fecha_fin" name="fecha_fin" required >

      <div class="button-group">
        <input type="submit" name="accion" value="publicar" class="btn-publicar" onclick="setAction('{% url 'Insertar_aviso' %}')">
        <input type="submit" name="accion" value="eliminar" class="btn-eliminar" onclick="setAction('{% url 'eliminar_aviso' %}')">
      </div>
    </form>
  </div>

 <script>
  const form = document.querySelector('form[action="."]');
  function setAction(url) {
    form.action = url;
  }

     //para obtener los datos del aviso
    document.getElementById("titulo").addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
      event.preventDefault();
      const titulo = this.value;

      fetch(`/avisos/obtener_aviso/?titulo=${encodeURIComponent(titulo)}`)
        .then(response => {
          if (!response.ok) throw new Error("No encontrado");
          return response.json();
        })
        .then(data => {
          document.getElementById("descripcion").value = data.descripcion;
          document.getElementById("fecha_publi").value = data.fecha_publi;
          document.getElementById("fecha_fin").value = data.fecha_fin;
          document.getElementById("id_aviso").value = data.id_aviso;
        })
        .catch(error => {
          alert("Aviso no encontrado");
          document.getElementById("descripcion").value = '';
          document.getElementById("fecha_publi").value = '';
          document.getElementById("fecha_fin").value = '';
          document.getElementById("id_aviso").value = '';

        });
    }
  });

//Para eliminar un aviso
  document.querySelector('.btn-eliminar').addEventListener('click', function (event) {
    event.preventDefault();

    const titulo = document.getElementById('titulo').value;

    fetch("{% url 'eliminar_aviso' %}", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            "X-CSRFToken": "{{ csrf_token }}",
        },
        body: `titulo=${encodeURIComponent(titulo)}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.success);
            document.getElementById('titulo').value = '';
            document.getElementById('descripcion').value = '';
            document.getElementById('fecha_publi').value = '';
            document.getElementById('fecha_fin').value = '';
            document.getElementById('id_aviso').value = '';
            
        } else if (data.limpiar) {
            alert(data.limpiar);

            document.getElementById('titulo').value = '';
            document.getElementById('descripcion').value = '';
            document.getElementById('fecha_publi').value = '';
            document.getElementById('fecha_fin').value = '';
            document.getElementById('id_aviso').value = '';
        }
    });
});
</script>


<script>
  const fechaPubli = document.getElementById("fecha_publi");
  const fechaFin = document.getElementById("fecha_fin");

  fechaPubli.addEventListener("change", function () {
    fechaFin.min = this.value;

    // Si la fecha de finalización es menor que la publicación, la limpia
    if (fechaFin.value < this.value) {
      fechaFin.value = "";
    }
  });
</script>


</body>
</html>

