{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Configuraciones Básicas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="{% static 'imagenes/logo.ico.jpg' %}" type="image/x-icon">
  <style>
    * {
    box-sizing: border-box;
  }

  body {
    background-color: #f1f8f5;
    background-image: url("{% static 'imagenes/Fondo.jpg' %}");
    background-size: cover;
    background-attachment: fixed;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
  }

  .panel {
    background-color: transparent;
    max-width: 1200px;
    margin: 50px auto;
    padding: 30px;
  }

  .panel h1 {
    text-align: center;
    background-color: rgba(255,255,255,0.9);
    padding: 18px;
    border-radius: 12px;
    box-shadow: 0 3px 12px rgba(0,0,0,0.1);
    color: #0f496e;
    margin-bottom: 35px;
    font-size: 2rem;
  }

  .grid-layout {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    align-items: start;
  }

  .admin-container {
    background-color: rgba(255,255,255,0.9);
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    padding: 20px;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
  }

  .admin-container:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 25px rgba(0,0,0,0.12);
  }

  h2 {
    text-align: center;
    color: #158599;
    margin-bottom: 15px;
    font-size: 1.25rem;
  }

  label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
    color: #158599;
    font-size: 0.95rem;
  }

  input[type="number"],
  input[type="text"],
  input[type="date"] {
    width: 90%;
    padding: 8px;
    margin: 5px auto 0 auto;
    border: 2px solid #a5c4d6;
    border-radius: 8px;
    font-size: 0.95rem;
    display: block;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }

  input:focus {
    border-color: #158599;
    box-shadow: 0 0 4px rgba(21,133,153,0.4);
    outline: none;
  }

  .button-group {
    display: flex;
    justify-content: space-between;
    gap: 8px;
    margin-top: 15px;
    flex-wrap: wrap;
  }

  .btn-agregar,
  .btn-eliminar {
    flex: 1;
    padding: 10px;
    font-size: 0.95rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .btn-agregar {
    background-color: #158599;
    color: white;
  }

  .btn-agregar:hover {
    background-color: #18486e;
  }

  .btn-eliminar {
    background-color: #cc3d3d;
    color: white;
  }

  .btn-eliminar:hover {
    background-color: #a82626;
  }

  .full-width-btn {
    width: 90%;
    margin-top: 15px;
    padding: 10px;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }

  /* Center panel: filas de cupos */
  .center-panel .cupos-row,
  .center-panel .cupos-row-tecnico {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-top: 10px;
    flex-wrap: wrap;
  }

  .center-panel .cupo-block,
  .center-panel .cupo-block-tecnico {
    flex: 1;
    text-align: center;
  }

.center-panel .cupo-block input {
  width: 40%;       /* antes 60% */
  padding: 3px 4px; /* antes 5px */
  font-size: 0.8rem;
}

  .center-panel .cupo-block-tecnico input {
    width: 50%;
    padding: 5px;
    font-size: 0.85rem;
  }

  /* Responsive: se apilan en pantallas pequeñas */
  @media (max-width: 900px) {
    .grid-layout {
      grid-template-columns: 1fr;
    }

    .center-panel .cupos-row,
    .center-panel .cupos-row-tecnico {
      flex-direction: column;
      gap: 10px;
    }

    .center-panel .cupo-block input,
    .center-panel .cupo-block-tecnico input {
      width: 90%;
    }

    
  }
  </style>
</head>
<body>
<div class="panel">

  {% if mensaje %}
  <div style="text-align:center; color: green; font-weight: bold; margin-bottom: 20px;">
    {{ mensaje }}
  </div>
  {% endif %}

  <div class="grid-layout">
    <!-- Técnico (izquierda) -->
    <div class="admin-container">
      <h2>Añadir Técnico</h2>
      <form action="{% url 'manejar_tecnico' %}" method="POST">
        {% csrf_token %}
        <label for="nombre_tecnico">Nombre del Técnico:</label>
        <input type="text" id="nombre_tecnico" name="nombre_tecnico" required>

        <div class="button-group">
          <button type="submit" name="accion" value="agregar" class="btn-agregar">Agregar</button>
          <button type="submit" name="accion" value="eliminar" class="btn-eliminar">Eliminar</button>
        </div>
      </form>
    </div>

    
  <!-- Formulario Inscripción -->
<div class="admin-container center-panel">
  <h2>Configurar Cupos</h2>
  <form action="{% url 'configurar_cupos' %}" method="POST">
    {% csrf_token %}

    <!-- Select para tipo -->
    <label for="tipo">Tipo de proceso:</label>
    <select id="tipo" name="tipo" required>
      <option value="Inscripcion">Inscripción</option>
      <option value="Reinscripcion">Reinscripción</option>
    </select>

    <label for="fecha_inicio_insc">Fecha Inicio:</label>
    <input type="date" id="fecha_inicio_insc" name="fecha_inicio">

    <label for="fecha_limite_insc">Fecha Límite:</label>
    <input type="date" id="fecha_limite_insc" name="fecha_limite">

    <!-- Cupos por grado y sección -->
    <div class="cupos-row">
      <div class="cupo-block">
        <label for="cupos_1ro_A">1ro A</label>
        <input type="number" id="cupos_1ro_A" name="cupos_1ro_A" min="0">
      </div>
      <div class="cupo-block">
        <label for="cupos_1ro_B">1ro B</label>
        <input type="number" id="cupos_1ro_B" name="cupos_1ro_B" min="0">
      </div>
      <div class="cupo-block">
        <label for="cupos_1ro_C">1ro C</label>
        <input type="number" id="cupos_1ro_C" name="cupos_1ro_C" min="0">
      </div>
    </div>
    <div class="cupos-row">
      <div class="cupo-block">
        <label for="cupos_2do_A">2do A</label>
        <input type="number" id="cupos_2do_A" name="cupos_2do_A" min="0">
      </div>
      <div class="cupo-block">
        <label for="cupos_2do_B">2do B</label>
        <input type="number" id="cupos_2do_B" name="cupos_2do_B" min="0">
      </div>
      <div class="cupo-block">
        <label for="cupos_2do_C">2do C</label>
        <input type="number" id="cupos_2do_C" name="cupos_2do_C" min="0">
      </div>
    </div>
    <div class="cupos-row">
      <div class="cupo-block">
        <label for="cupos_3ro_A">3ro A</label>
        <input type="number" id="cupos_3ro_A" name="cupos_3ro_A" min="0">
      </div>
      <div class="cupo-block">
        <label for="cupos_3ro_B">3ro B</label>
        <input type="number" id="cupos_3ro_B" name="cupos_3ro_B" min="0">
      </div>
      <div class="cupo-block">
        <label for="cupos_3ro_C">3ro C</label>
        <input type="number" id="cupos_3ro_C" name="cupos_3ro_C" min="0">
      </div>
    </div>
    
   <div class="cupos-row" style="margin-top: 10px; justify-content: flex-start;">
  <div class="cupo-block" style="display: flex; align-items: center; gap: 10px;">
    <h3 class="titulo-azul" style="margin: 0; font-size: 1rem; color:#158599" >Cupos para todos los técnicos </h3>
    <input type="number" id="cupos_tecnicos" name="cupos_tecnicos" min="0" value="0" style="width: 15%; padding: 5px; font-size: 0.85rem;">
  </div>
</div>


    <button type="submit" class="btn-agregar full-width-btn">Guardar</button>
  </form>
</div>




    <!-- Grado/Nivel (derecha) -->
    <div class="admin-container">
      <h2>Añadir Nivel</h2>
      <form action="{% url 'manejar_grado' %}" method="POST">
        {% csrf_token %}
        <label for="nombre_grado">Nombre del Nivel:</label>
        <input type="text" id="nombre_grado" name="nombre_grado" required>

        <div class="button-group">
          <button type="submit" name="accion" value="agregar" class="btn-agregar">Agregar</button>
          <button type="submit" name="accion" value="eliminar" class="btn-eliminar">Eliminar</button>
        </div>

      </form>
    </div>
  </div>
</div>


<script>
  const fechaInicio = document.getElementById("fecha_inicio_insc");
  const fechaLimite = document.getElementById("fecha_limite_insc");

  // Cada vez que cambia la fecha de inicio
  fechaInicio.addEventListener("change", function () {
    // Establecer la fecha mínima permitida en la fecha límite
    fechaLimite.min = this.value;

    // Si ya había una fecha límite y es menor que la de inicio, se limpia
    if (fechaLimite.value < this.value) {
      fechaLimite.value = "";
    }
  });
</script>


<script>
document.addEventListener("DOMContentLoaded", function() {
    // Contenedor de "Añadir Nivel"
    const adminNivel = document.querySelector('.admin-container:nth-of-type(3)'); 
    const inputNivel = adminNivel.querySelector('#nombre_grado');
    const btnAgregar = adminNivel.querySelector('.btn-agregar');
    const btnEliminar = adminNivel.querySelector('.btn-eliminar');
    const buttonGroup = adminNivel.querySelector('.button-group');

    // Llamada AJAX para verificar niveles
    fetch("{% url 'verificar_grados' %}")
        .then(response => response.json())
        .then(data => {
            if(data.niveles_completos) {
                // Deshabilitar input
                inputNivel.disabled = true;

                // Eliminar botones
                btnAgregar.remove();
                btnEliminar.remove();

                // Crear mensaje
                const mensaje = document.createElement('p');
                mensaje.style.color = 'rgb(184, 134, 11)'; // amarillo oscuro
                mensaje.style.textAlign = 'center';
                mensaje.style.fontWeight = 'bold';
                mensaje.style.marginTop = '10px';
                mensaje.textContent = 'Ya existen todos los niveles del 1ro al 6to. No se pueden agregar ni eliminar niveles.';

                buttonGroup.appendChild(mensaje);
            }
        })
        .catch(error => console.error('Error al verificar niveles:', error));
});
</script>







</body>
</html>
